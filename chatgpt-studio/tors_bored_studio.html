<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Tors‑Bored Studio — Interactive Gallery</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Caveat+Brush&family=Caveat:wght@400..700&display=swap" rel="stylesheet">
  <style>
    /* Page frame */
    html, body { height: 100%; margin: 0; }
    body {
      display: grid;
      place-items: center;
      background: radial-gradient(60% 80% at 50% 40%, #1d2b23 0%, #0f1512 100%);
      /* You can sample a color from the painting later if you prefer */
    }

    /* Responsive SVG container: keep full painting visible without crop */
    .stage {
      width: min(1200px, 96vw);
      height: auto;
      aspect-ratio: 1536 / 1024; /* maintains painting ratio */
      display: block;
      box-shadow: 0 20px 60px rgba(0,0,0,0.35);
      border-radius: 14px;
      background: #0a0d0c;
    }

    /* Interaction affordances */
    .vase {
      cursor: pointer;
      outline: none;
      /* Enable CSS transforms to respect the element box */
      transform-box: fill-box; /* critical for SVG */
      transform-origin: center;
      transition: transform 160ms ease, filter 160ms ease;
    }
    .vase:hover,
    .vase:focus-visible,
    .vase[aria-expanded="true"] { /* expanded when bubble open */
      transform: scale(1.02);
      filter: url(#white-outline);
    }

    /* Thought bubbles */
    .bubble { display: none; }
    .bubble.open { display: block; }

    /* Bubble text styling */
    .bubble text { font-family: ui-serif, Georgia, "Times New Roman", serif; font-size: 18px; fill: #1b1b1b; }
    .bubble .title { font-weight: 700; }
    .bubble .body { font-size: 16px; }

    /* Foreign object bubble content styling */
    .bubble-content {
      font-family: "Caveat", cursive;
      color: #1b1b1b;
      text-align: center;
      padding: 8px 12px;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      gap: 4px;
      box-sizing: border-box;
    }
    .bubble-content .title {
      font-family: "Caveat Brush", cursive;
      font-weight: 400;
      font-size: 20px;
      line-height: 1.2;
      word-wrap: break-word;
    }
    .bubble-content .body {
      font-family: "Caveat", cursive;
      font-optical-sizing: auto;
      font-weight: 500;
      font-style: normal;
      font-size: 18px;
      line-height: 1.3;
      word-wrap: break-word;
    }

    /* Accessibility helper for keyboard focus */
    .visually-hidden { position: absolute; width: 1px; height: 1px; margin: -1px; border: 0; padding: 0; clip: rect(0 0 0 0); overflow: hidden; }
  </style>
</head>
<body>

  <!-- Single SVG scene with shared coordinate system -->
  <svg id="scene" class="stage" viewBox="0 0 1536 1024" role="img" aria-label="Tors-Bored Studio interactive pottery gallery">
    <defs>
      <!-- Small white outline that hugs image alpha; applied on hover/focus -->
      <filter id="white-outline" x="-20%" y="-20%" width="140%" height="140%" color-interpolation-filters="sRGB">
        <!-- Extract alpha -->
        <feColorMatrix in="SourceAlpha" type="matrix" values="1 0 0 0 0  0 1 0 0 0  0 0 1 0 0  0 0 0 1 0" result="alpha"/>
        <!-- Slightly dilate and blur to create a soft halo -->
        <feMorphology in="alpha" operator="dilate" radius="0.7" result="dilated"/>
        <feGaussianBlur in="dilated" stdDeviation="1.1" result="blur"/>
        <!-- Paint it white -->
        <feFlood flood-color="#ffffff" flood-opacity="1" result="white"/>
        <feComposite in="white" in2="blur" operator="in" result="outline"/>
        <!-- Put outline behind the original graphic -->
        <feMerge>
          <feMergeNode in="outline"/>
          <feMergeNode in="SourceGraphic"/>
        </feMerge>
      </filter>

      <!-- Bubble shape definitions: rounded rect + soft shadow -->
      <filter id="bubble-shadow" x="-20%" y="-30%" width="160%" height="200%">
        <feDropShadow dx="0" dy="3" stdDeviation="3" flood-color="#000" flood-opacity="0.25"/>
      </filter>
    </defs>

    <!-- Background painting -->
    <image href="images/background.jpeg" x="0" y="0" width="1536" height="1024" preserveAspectRatio="none"/>

    <!-- Title / Logo -->
    <image href="images/tors-bored.png" x="511" y="0" width="513" height="342"/>

    <!-- About sign linking to /about -->
    <a href="/about" aria-label="About Tors-Bored Studio">
      <image href="images/about.png" x="1256" y="0" width="192" height="192"/>
    </a>

    <!-- ===== VASES (each inside a focusable <g>) ===== -->

    <!-- Helper: bubble templates will be cloned/positioned via JS per vase -->
    <!-- Default bubble template (tail pointing down) -->
    <g id="bubble-template" class="bubble" opacity="0.98">
      <!-- rect background -->
      <rect x="-130" y="-90" width="260" height="100" rx="14" ry="14" fill="#faf6f0" filter="url(#bubble-shadow)"/>
      <!-- tail (triangle-ish) pointing downward by default -->
      <path d="M 0 10 L -10 0 L 10 0 Z" fill="#faf6f0"/>
      <!-- text blocks using foreignObject for text wrapping -->
      <foreignObject x="-120" y="-85" width="240" height="90">
        <div class="bubble-content" xmlns="http://www.w3.org/1999/xhtml">
          <div class="title">Title</div>
          <div class="body">Body</div>
        </div>
      </foreignObject>
    </g>

    <!-- Left bubble template (tail pointing right) -->
    <g id="bubble-template-left" class="bubble" opacity="0.98">
      <!-- rect background -->
      <rect x="-260" y="-50" width="260" height="100" rx="14" ry="14" fill="#faf6f0" filter="url(#bubble-shadow)"/>
      <!-- tail pointing right -->
      <path d="M 0 0 L -10 -10 L -10 10 Z" fill="#faf6f0"/>
      <!-- text blocks using foreignObject for text wrapping -->
      <foreignObject x="-250" y="-45" width="240" height="90">
        <div class="bubble-content" xmlns="http://www.w3.org/1999/xhtml">
          <div class="title">Title</div>
          <div class="body">Body</div>
        </div>
      </foreignObject>
    </g>

    <!-- Right bubble template (tail pointing left) -->
    <g id="bubble-template-right" class="bubble" opacity="0.98">
      <!-- rect background -->
      <rect x="0" y="-50" width="260" height="100" rx="14" ry="14" fill="#faf6f0" filter="url(#bubble-shadow)"/>
      <!-- tail pointing left -->
      <path d="M 0 0 L 10 -10 L 10 10 Z" fill="#faf6f0"/>
      <!-- text blocks using foreignObject for text wrapping -->
      <foreignObject x="10" y="-45" width="240" height="90">
        <div class="bubble-content" xmlns="http://www.w3.org/1999/xhtml">
          <div class="title">Title</div>
          <div class="body">Body</div>
        </div>
      </foreignObject>
    </g>

    <!-- Green Spiral Vase -->
    <g id="vase-green" class="vase" tabindex="0" role="button" aria-label="Green Spiral Vase" aria-expanded="false"
       data-title="Green Spiral Vase"
       data-body="Tall coil form, carved spirals, olive over ochre."
       data-bubble-offset="56">
      <image href="images/green-vase.png" x="400" y="349" width="242" height="363"/>
    </g>

    <!-- Owl (Fnoobie) -->
    <g id="vase-owl" class="vase" tabindex="0" role="button" aria-label="Owl Vase" aria-expanded="false"
       data-title="Owl Vase (Fnoobie)"
       data-body="Textured stoneware, butter glaze; cozy night light."
       data-bubble-offset="56"
       data-bubble-position="left">
      <image href="images/fnoobie.png" x="1351" y="525" width="126" height="189" transform="rotate(5 1414 613.5)"/>
    </g>

    <!-- Tomato Jar -->
    <g id="vase-tomato" class="vase" tabindex="0" role="button" aria-label="Tomato Jar" aria-expanded="false"
       data-title="Tomato Jar"
       data-body="Hand-built lidded jar; glossy red slip with green knob."
       data-bubble-offset="72">
      <image href="images/tomato.png" x="777" y="555" width="157" height="157"/>
    </g>

    <!-- White Tall Ribbed -->
    <g id="vase-ribbed" class="vase" tabindex="0" role="button" aria-label="White Tall Ribbed" aria-expanded="false"
       data-title="White Tall Ribbed"
       data-body="Thrown, altered; speckled clay, satin eggshell."
       data-bubble-offset="72">
      <image href="images/white-rib-vase.png" x="664" y="765" width="139" height="209"/>
    </g>

    <!-- Multicolor (Mondrian) -->
    <g id="vase-mondrian" class="vase" tabindex="0" role="button" aria-label="Multicolor Vase"
       data-title="Multicolor Vase"
       data-body="Playful color blocks over warm porcelain."
       data-bubble-offset="72">
      <image href="images/multicolor-vase.png" x="239" y="783" width="161" height="241"/>
    </g>

    <!-- Flower Vase -->
    <g id="vase-flower" class="vase" tabindex="0" role="button" aria-label="Flower Vase" aria-expanded="false"
       data-title="Flower Vase"
       data-body="Soft blossoms over matte ivory; spring in a vessel."
       data-bubble-offset="56"
       data-bubble-position="right">
      <image href="images/white-flower.png" x="30.9" y="515" width="90" height="139" transform="rotate(-6 74.9 577.97)"/>
    </g>

  </svg>

  <script>
    (function() {
      const svg = document.getElementById('scene');
      const groups = Array.from(svg.querySelectorAll('.vase'));
      const template = svg.getElementById('bubble-template');
      const templateLeft = svg.getElementById('bubble-template-left');
      const templateRight = svg.getElementById('bubble-template-right');

      let openBubble = null; // enforce single-bubble rule

      function placeBubbleForGroup(g) {
        // Remove existing bubble if any
        const old = g.querySelector('.bubble');
        if (old && old !== template && old !== templateLeft && old !== templateRight) old.remove();

        // Determine which template to use based on bubble position
        const position = g.dataset.bubblePosition || 'top';
        let templateToUse;
        switch(position) {
          case 'left':
            templateToUse = templateLeft;
            break;
          case 'right':
            templateToUse = templateRight;
            break;
          default:
            templateToUse = template;
        }

        // Clone appropriate template and inject content
        const b = templateToUse.cloneNode(true);
        b.id = '';
        b.classList.add('open');

        const title = g.dataset.title || '';
        const body = g.dataset.body || '';
        b.querySelector('.title').textContent = title;
        b.querySelector('.body').textContent = body;

        // Compute anchor based on position
        const bbox = g.getBBox();
        const offset = parseFloat(g.dataset.bubbleOffset || '56');
        let anchorX, anchorY;

        switch(position) {
          case 'left':
            // Position to the left of the vase
            anchorX = bbox.x - 20;
            anchorY = bbox.y + bbox.height / 2;
            break;
          case 'right':
            // Position to the right of the vase
            anchorX = bbox.x + bbox.width + 20;
            anchorY = bbox.y + bbox.height / 2;
            break;
          default:
            // Default: above the vase
            anchorX = bbox.x + bbox.width / 2;
            anchorY = bbox.y - offset;
        }

        // Position by translating the whole bubble group
        b.setAttribute('transform', `translate(${anchorX}, ${anchorY})`);

        // Mark for styling/show
        b.classList.add('bubble');
        g.appendChild(b);

        openBubble = { group: g, bubble: b };
        g.setAttribute('aria-expanded', 'true');
      }

      function closeOpenBubble() {
        if (!openBubble) return;
        const { group, bubble } = openBubble;
        if (bubble && bubble.parentNode) bubble.parentNode.removeChild(bubble);
        if (group) group.setAttribute('aria-expanded', 'false');
        openBubble = null;
      }

      // Event wiring per group
      groups.forEach(g => {
        // Hover (desktop): open on enter, close on leave
        g.addEventListener('pointerenter', () => {
          closeOpenBubble();
          placeBubbleForGroup(g);
        });
        g.addEventListener('pointerleave', () => {
          // Only close if the bubble belongs to this group
          if (openBubble && openBubble.group === g) closeOpenBubble();
        });

        // Keyboard: Enter/Space toggles; Esc closes
        g.addEventListener('keydown', (e) => {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            if (openBubble && openBubble.group === g) closeOpenBubble();
            else { closeOpenBubble(); placeBubbleForGroup(g); }
          }
          if (e.key === 'Escape') { closeOpenBubble(); }
        });

        // Touch/click: toggle
        g.addEventListener('click', (e) => {
          e.stopPropagation();
          if (openBubble && openBubble.group === g) closeOpenBubble();
          else { closeOpenBubble(); placeBubbleForGroup(g); }
        });
      });

      // Close bubbles when clicking outside
      document.addEventListener('click', (e) => {
        // If click is outside the SVG or not inside current open group, close
        if (!openBubble) return;
        const target = e.target;
        if (!svg.contains(target)) { closeOpenBubble(); return; }
        // If click is inside the open group, ignore (handled above)
        if (openBubble.group.contains(target)) return;
        closeOpenBubble();
      });

      // Optional: close on ESC anywhere
      document.addEventListener('keydown', (e) => { if (e.key === 'Escape') closeOpenBubble(); });
    })();
  </script>
</body>
</html>
